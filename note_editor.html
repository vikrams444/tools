<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="Spicy444">
    <meta name="description" content="A modern, offline-capable note editor with live stats, readability analysis, and productivity tools.">
    <meta name="keywords" content="note editor, offline writing assistant, live stats, readability analysis, productivity tools, pomodoro timer, writing goal tracker">
    <title>Spicy444 Node Editor - Offline Writing Assistant</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Lato&family=Roboto&family=Slabo+27px&family=Source+Code+Pro&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #57c2f0;
            --secondary-color: #45A29E;
            --background-light: #f4f4f9;
            --text-light: #0B0C10;
            --card-bg-light: #ffffff;
            --background-dark: #0B0C10;
            --text-dark: #C5C6C7;
            --card-bg-dark: #1F2833;
            --border-light: #e0e0e0;
            --border-dark: #2c3e50;
            --shadow-light: rgba(0, 0, 0, 0.1);
            --shadow-dark: rgba(0, 0, 0, 0.4);
            --primary: #66FCF1;
            --background: #0B0C10;
            --card-bg: #1F2833;
        }

        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            transition: background-color 0.3s, color 0.3s;
        }

        body.light-mode {
            background-color: var(--background-light);
            color: var(--text-light);
        }

        body.dark-mode {
            background-color: var(--background-dark);
            color: var(--text-dark);
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 2rem;
            box-shadow: 0 2px 10px var(--shadow-light);
            transition: background-color 0.3s;
        }
        
        body.light-mode .header {
            background-color: var(--card-bg-light);
            box-shadow: 0 2px 10px var(--shadow-light);
        }

        body.dark-mode .header {
            background-color: var(--card-bg-dark);
            box-shadow: 0 2px 10px var(--shadow-dark);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo-circle {
            width: 60px;
            height: 40px;
             position: relative;
            background-image: linear-gradient(135deg, var(--primary-color), blue);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            font-size: 1.2rem;
            color: var(--background-dark);
        }

        .rock {animation:rock 1.10s linear infinite;}

        @keyframes rock {  0% {    transform: rotate(0deg);  }
        25% {    transform: rotate(20deg);  }
        50% {    transform: rotate(0deg);  }
        75% {    transform: rotate(-20deg);  }
        100% {    transform: rotate(-0deg);  }};
        
        .header h1 {
            font-size: 1.8rem;
            margin: 0;
        }
        
        body.light-mode .header h1 { color: var(--text-light); }
        body.dark-mode .header h1 { color: var(--primary-color); }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .theme-toggle {
            cursor: pointer;
            font-size: 1.5rem;
            background: none;
            border: none;
            color: inherit;
        }

        /* Main Content */
        .main-container {
            display: flex;
            flex: 1;
            padding: 1rem;
            gap: 1rem;
            overflow: hidden; /* Prevent horizontal scroll */
        }

        .editor-container {
            flex: 3;
            display: flex;
            flex-direction: column;
            min-width: 0; /* Allow editor to shrink */
            position: relative; /* For autocomplete positioning */
        }

        .toolbar {
            padding: 0.5rem;
            border-radius: 8px 8px 0 0;
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            align-items: center;
            
        }

        
        .toolbar-left {     
            display: flex;
            gap: 0.7rem;
            width: 75%;
            align-items: flex-start;
            flex-wrap: wrap;         
        }

        .toolbar-right {    
            display: flex; 
            gap: 0.5rem;  
            width: 21%;
            align-items: flex-end;
            flex-wrap: wrap;
        }
        
        body.light-mode .toolbar { background-color: #eee; }
        body.dark-mode .toolbar { background-color: #181e25; }

        .toolbar button {
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--text);
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        body.light-mode .toolbar button { background-color: #e2dcdcef; color: var(--text-light); }
        body.dark-mode .toolbar button { background-color:var(--card-bg-dark); color: var(--text-dark); }
        body.light-mode .toolbar select { background-color: #c1b4b4ef; color: var(--text-light); border: 1px solid var(--border-light); }
        body.dark-mode .toolbar select { background-color:var(--card-bg-dark); color: var(--text-dark); border: 1px solid var(--border-dark); }


        /* FIXED: Added a more prominent style for the active button state */
        .toolbar button.active {
            background-color: var(--primary-color);
            color: var(--background-dark);
            box-shadow: 0 0 8px var(--primary-color);
            transform: translateY(-2px);
        }

        .toolbar select {
            border-radius: 4px;
            padding: 0.5rem;
            cursor: pointer;
            font-size: 1rem;
            color: inherit;
            flex-shrink: 0; /* Prevent buttons from shrinking */
        }
        .toolbar button:hover, .toolbar select:hover {
            background-color: rgba(102, 252, 241, 0.2);
            border-color: var(--primary-color);
            transition: background-color 0.3s, border-color 0.3s;
        }
        
       
        .toolbar:nth-child(1) #focus-mode-btn{
            color: #d9534f;
        }

        .toolbar:nth-child(1) #export-txt-btn  {
            color: #f39c12;
        }

        .toolbar:nth-child(1) #export-md-btn   {
            color: #5cb85c;
        }
        .toolbar #export-pdf-btn {
            color: #0468cc;
        }

        #editor {
            flex: 1;
            padding: 1.5rem;
            font-size: 1.1rem;
            line-height: 1.6;
            border: 1px solid var(--border-light);
            border-radius: 0 0 8px 8px;
            outline: none;
            resize: none;
            width: 100%;
            box-sizing: border-box;
            transition: background-color 0.3s, color 0.3s, border-color 0.3s;
            overflow-y: auto;
        }

        body.light-mode #editor {
            background-color: var(--card-bg-light);
            color: var(--text-light);
            border-color: var(--border-light);
        }
        body.dark-mode #editor {
            background-color: #212932;
            color: var(--text-dark);
            border-color: var(--border-dark);
        }

        /* Autocomplete Box */
        #autocomplete-box {
            display: none;
            position: absolute;
            border: 1px solid transparent;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            border-radius: 4px;
        }
        body.dark-mode #autocomplete-box {
            background-color: var(--card-bg-dark);
            border-color: var(--border-dark);
            border-left: 3px solid var(--primary);           
        }
        body.light-mode #autocomplete-box {
            background-color: var(--card-bg-light);
            border-color: var(--border-light);
        }
        .autocomplete-item {
            padding: 8px 12px;
            cursor: pointer;            
        }
        .autocomplete-item:hover, .autocomplete-item.active {
            background-color: rgba(102, 252, 241, 0.2);
            border-color: var(--primary-color);
            transition: background-color 0.3s, border-color 0.3s;
        }
        
        /* Popup Styles */
        .popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--card-bg);
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            z-index: 1000;
            text-align: center;
            max-width: 80%;
        }

        .popup-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 999;
        }

        .popup button {
            background: var(--primary);
            color: var(--card-bg);
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            margin-top: 1rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .popup button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 252, 241, 0.4);
        }

        /* Sidebar */
        .sidebar {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            min-width: 280px;
        }

        .sidebar-card {
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 2px 5px var(--shadow-light);
            transition: background-color 0.3s;
        }
        
        body.light-mode .sidebar-card {
            background-color: var(--card-bg-light);
            box-shadow: 0 2px 5px var(--shadow-light);
        }
        body.dark-mode .sidebar-card {
            background-color: var(--card-bg-dark);
            box-shadow: 0 2px 10px var(--shadow-dark);
        }

        .sidebar-card h3 {
            margin-top: 0;
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 0.5rem;
            margin-bottom: 1rem;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .stat-item span:last-child {
            font-weight: bold;
            color: var(--primary-color);
        }

        /* Readability Score */
        #readability-score {
            font-size: 1.5rem;
            font-weight: bold;
            text-align: center;
        }
        #readability-grade {
            text-align: center;
            font-style: italic;
            margin-top: 0.5rem;
        }
        .easy { color: #2ecc71; }
        .moderate { color: #f39c12; }
        .difficult { color: #e74c3c; }

        /* Pomodoro Timer */
        #timer-display {
            font-size: 2.5rem;
            text-align: center;
            margin: 1rem 0;
            font-weight: bold;
        }
        .timer-controls button {
            width: 100%;
            padding: 0.75rem;
            margin-top: 0.5rem;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            background-color: var(--primary-color);
            color: var(--background-dark);
            font-weight: bold;
        }
        .timer-controls button:hover {
            background-color: var(--secondary-color);
        }
        
        /* Goal Tracker */
        #goal-progress-bar {
            width: 100%;
            background-color: #ddd;
            border-radius: 5px;
        }
        #goal-progress {
            width: 0%;
            height: 20px;
            background-color: var(--primary-color);
            border-radius: 5px;
            text-align: center;
            line-height: 20px;
            color: var(--background-dark);
            font-weight: bold;
        }
        #goal-input {
            width: 100%;
            padding: 0.5rem;
            margin-top: 0.5rem;
            box-sizing: border-box;
            border-radius: 4px;
        }
        
        body.dark-mode #goal-input {
            background-color: #2c3e50;
            color: var(--text-dark);
            border: 1px solid var(--border-dark);
        }
        body.light-mode #goal-input {
            background-color: var(--card-bg-light);
            color: var(--text-light);
            border: 1px solid var(--border-light);
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 1.5rem;
            margin-top: 1rem;
            transition: background-color 0.3s;
        }
        
        body.light-mode .footer {
            background-color: var(--card-bg-light);
            box-shadow: 0 -2px 10px var(--shadow-light);
        }
        body.dark-mode .footer {
            background-color: var(--card-bg-dark);
            box-shadow: 0 -2px 10px var(--shadow-dark);
        }
        .footer p { margin: 0.5rem 0; }
        .footer a { color: var(--primary-color); text-decoration: none; }
        .footer a:hover { text-decoration: underline; }

        /* Focus Mode */
        body.focus-mode .header,
        body.focus-mode .sidebar,
        body.focus-mode .footer {
            display: none;
        }
        body.focus-mode .main-container {
            padding: 0;
        }
        body.focus-mode .editor-container {
            height: 100vh;
        }
        body.focus-mode #editor {
            border-radius: 0;
            border: none;
            height: 100%;
        }

        /* Responsive */
        @media (max-width: 992px) {
            .main-container {
                flex-direction: column;
            }
            .sidebar {
                flex-direction: row;
                flex-wrap: wrap;
                justify-content: center;
            }
            .sidebar-card {
                flex-basis: 48%;
            }
        }
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 1rem;
            }
            .sidebar {
                flex-direction: column;
            }
            .sidebar-card {
                flex-basis: 100%;
            }
        }
    </style>
</head>
<body class="dark-mode">

    <header class="header">
        <div class="logo">
            <div class="logo-circle rock">Spicy</div>
            <h1>Note Editor</h1>
        </div>
        <div class="header-controls">
            <button class="theme-toggle" id="theme-toggle-btn">
                <i class="fas fa-sun"></i>
            </button>
        </div>
    </header>

    <div class="main-container">
        <div class="editor-container">
            <div class="toolbar">
                <div class="toolbar-left">                    
                    <button id="bold-btn" title="Bold (Ctrl+B)"><i class="fas fa-bold"></i></button>
                    <button id="italic-btn" title="Italic (Ctrl+I)"><i class="fas fa-italic"></i></button>
                    <button id="underline-btn" title="Underline (Ctrl+U)"><i class="fas fa-underline"></i></button>
                    <button id="unorderedListBtn" title="Bullet List"><i class="fas fa-list-ul"></i></button>
                    <button id="orderedListBtn" title="Numbered List"><i class="fas fa-list-ol"></i></button>
                    <button id="undo-btn" title="Undo (Ctrl+Z)"><i class="fas fa-undo"></i></button>
                    <button id="redo-btn" title="Redo (Ctrl+Y)"><i class="fas fa-redo"></i></button>
                    <select id="font-select" title="Change Font">
                        <option value="'Consolas', monospace">Consolas (Mono)</option>
                        <option value="'Arial', sans-serif">Arial (Sans-serif)</option>
                        <option value="'Courier New', monospace">Courier New (Mono)</option>
                        <option value="'Fira Code', monospace">Fira Code (Mono)</option>
                        <option value="'Georgia', serif">Georgia (Serif)</option>
                        <option value="'Helvetica', sans-serif">Helvetica (Sans-serif)</option>
                        <option value="'Inter', sans-serif" selected>Inter (Sans-serif)</option>
                        <option value="'Lato', sans-serif">Lato</option>
                        <option value="'Montserrat', sans-serif">Montserrat (Sans-serif)</option>
                        <option value="'Roboto', sans-serif">Roboto</option>
                        <option value="'Roboto Mono', monospace">Roboto Mono (Mono)</option>
                        <option value="'Slabo 27px', serif">Slabo</option>
                        <option value="'Source Code Pro', monospace">Source Code Pro (Mono)</option>
                        <option value="'Times New Roman', serif">Times New Roman (Serif)</option>                    
                    </select>
                </div>  
                <div class="toolbar-right">
                    <button id="focus-mode-btn" title="Focus Mode"><i class="fas fa-expand"></i></button>
                    <button id="export-txt-btn" title="Export as .txt"><i class="fas fa-file-alt"></i></button>
                    <button id="export-md-btn" title="Export as .md"><i class="fab fa-markdown"></i></button>
                    <button id="export-pdf-btn" title="Export as .pdf"><i class="fas fa-file-pdf"></i></button>
                </div>
            </div>
            <div id="editor" contenteditable="true" placeholder="Start writing... your work is saved automatically."></div>
            <div id="autocomplete-box"></div>
        </div>

        <aside class="sidebar">
            <div class="sidebar-card">
                <h3>Live Stats</h3>
                <div class="stat-item"><span>Words:</span> <span id="word-count">0</span></div>
                <div class="stat-item"><span>Characters:</span> <span id="char-count">0</span></div>
                <div class="stat-item"><span>Sentences:</span> <span id="sentence-count">0</span></div>
                <div class="stat-item"><span>Paragraphs:</span> <span id="paragraph-count">0</span></div>
                <div class="stat-item"><span>Reading Time:</span> <span id="reading-time">0 min</span></div>
            </div>

            <div class="sidebar-card">
                <h3>Readability</h3>
                <div id="readability-score" class="easy">0.0</div>
                <div id="readability-grade">Easy to read</div>
            </div>
            
            <div class="sidebar-card">
                <h3>Grammar & Style</h3>
                <div class="stat-item"><span>Passive Voice:</span> <span id="passive-count">0</span></div>
                <div class="stat-item"><span>Filler Words:</span> <span id="filler-count">0</span></div>
                <div class="stat-item"><span>Repeated Words:</span> <span id="repeated-count">0</span></div>
            </div>

            <div class="sidebar-card">
                <h3>Productivity Tools</h3>
                <div class="tool-section">
                    <h4>Pomodoro Timer</h4>
                    <div id="timer-display">25:00</div>
                    <div class="timer-controls">
                        <button id="start-timer-btn">Start Work</button>
                        <button id="reset-timer-btn">Reset</button>
                    </div>
                </div>
            </div>
            
            <div class="sidebar-card">
                <h3>Writing Goal</h3>
                <input type="number" id="goal-input" placeholder="Set word goal (e.g., 500)">
                <div id="goal-progress-bar">
                    <div id="goal-progress">0%</div>
                </div>
            </div>
        </aside>
    </div>

    <footer class="footer">
        <p><strong>Note Editor</strong> - Your data never leaves your browser.</p>
        <p>&copy;Spicy444 2025 Note Editor . All rights reserved. | <a href="#" id="reset-app">Reset Application</a></p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const editorContainer = document.querySelector('.editor-container');
            const editor = document.getElementById('editor');
            const autocompleteBox = document.getElementById('autocomplete-box');

            // --- Simple Offline Dictionary for Autocomplete ---
            const dictionary = [
                "a", "about", "all", "also", "and", "as", "at", "be", "because", "but", "by",
                "can", "come", "could", "day", "do", "even", "find", "first", "for", "from",
                "get", "give", "go", "have", "he", "her", "here", "him", "his", "how", "I",
                "if", "in", "into", "it", "its", "just", "know", "like", "look", "make", "man",
                "many", "me", "more", "my", "new", "no", "not", "now", "of", "on", "one",
                "only", "or", "other", "our", "out", "people", "say", "see", "she", "so",
                "some", "take", "tell", "than", "that", "the", "their", "them", "then", "there",
                "these", "they", "thing", "think", "this", "those", "time", "to", "two", "up",
                "use", "very", "want", "was", "way", "we", "well", "what", "when", "which",
                "who", "will", "with", "would", "year", "you", "your", "technology", "programming",
                "javascript", "writing", "assistant", "offline", "privacy", "document","ability",                
                "able", "about", "above", "accept", "according", "account", "across", "act", "action",
                "activity", "actually", "add", "address", "administration", "admit", "adult", "affect",
                "after", "again", "against", "age", "agency", "agent", "ago", "agree", "agreement",
                "ahead", "air", "all", "allow", "almost", "alone", "along", "already", "also", "although",
                "always", "American", "among", "amount", "analysis", "and", "animal", "another",
                "answer", "any", "anyone", "anything", "appear", "apply", "approach", "area",
                "argue", "arm", "around", "arrive", "art", "article", "artist", "as", "ask",
                "assume", "at", "attack", "attention", "attorney", "audience", "author", "authority",
                "available", "avoid", "away", "baby", "back", "bad", "bag", "ball", "bank", "bar",
                "base", "be", "beat", "beautiful", "because", "become", "bed", "before", "begin",
                "behavior", "behind", "believe", "benefit", "best", "better", "between", "beyond",
                "big", "bill", "billion", "bit", "black", "blood", "blue", "board", "body", "book",
                "born", "both", "box", "boy", "break", "bring", "brother", "budget", "build",
                "building", "business", "but", "buy", "by", "call", "camera", "campaign", "can",
                "cancer", "candidate", "capital", "car", "card", "care", "career", "carry",
                "case", "catch", "cause", "cell", "center", "central", "century", "certain", "certainly",
                "chair", "challenge", "chance", "change", "character", "charge", "check", "child",
                "choice", "choose", "church", "citizen", "city", "civil", "claim", "class", "clear",
                "clearly", "close", "coach", "cold", "collection", "college", "color",
                "come", "commercial", "common", "community", "company", "compare", "computer", "concern",
                "condition", "conference", "Congress", "consider", "consumer", "contain", "continue",
                "control", "cost", "could", "country", "couple", "course", "court", "cover", "create",
                "crime", "cultural", "culture", "cup", "current", "customer", "cut", "dark", "data", "daughter",
                "day", "dead", "deal", "death", "debate", "decade", "decide", "decision", "deep", "defense",
                "degree", "Democrat", "democratic", "describe", "design", "despite", "detail", "determine",
                "develop", "development", "die", "difference", "different", "difficult", "dinner", "direction", 
                "director", "discover", "discuss", "discussion", "disease", "do", "doctor", "dog", "door", "down", 
                "draw", "dream", "drive", "drop", "drug", "during", "each", "early", "east", "easy", "eat", "economic", 
                "economy", "edge", "education", "effect", "effort", "eight", "either", "election", "else", "employee", "end", 
                "energy", "enjoy", "enough", "enter", "entire", "environment", "environmental", "especially", "establish", "even", 
                "evening", "event", "ever", "every", "everybody", "everyone", "everything", "evidence", "exactly", "example", 
                "executive", "exist", "expect", "experience", "expert", "explain", "eye", "face", "fact", "factor", "fail", 
                "fall", "family", "far", "fast", "father", "favor", "fear", "federal", "feel", "feeling", "few", "field", 
                "fight", "figure", "fill", "film", "final", "finally", "financial", "find", "fine", "finger", "finish", "fire", 
                "firm", "first", "fish", "five", "floor", "fly", "focus", "follow", "food", "foot", "for", "force", 
                "foreign", "forget", "form", "former", "forward", "four", "free", "friend", "from", "front", "full", 
                "fund", "future", "game", "garden", "gas", "general", "generation", "get", "girl", "give", "glass", 
                "go", "goal", "good", "government", "great", "green", "ground", "group", "grow", "growth", "guess", 
                "gun", "guy", "hair", "half", "hand", "hang", "happen", "happy", "hard", "have", "he", "head", "health", 
                "hear", "heart", "heat", "heavy", "help", "her", "here", "herself", "high", "him", "himself", "his", 
                "history", "hit", "hold", "home", "hope", "hospital", "hot", "hotel", "hour", "house", "how", "however", 
                "huge", "human", "hundred", "husband", "I", "idea", "identify", "if", "image", "imagine", "impact", "important", 
                "improve", "in", "include", "including", "increase", "indeed", "indicate", "individual", "industry", 
                "information", "inside", "instead", "institution", "interest", "interesting", "international", "interview", 
                "into", "investment", "involve", "issue", "it", "item", "its", "itself", "job", "join", "just", "keep", "key", 
                "kid", "kill", "kind", "kitchen", "know", "knowledge", "land", "language", "large", "last", "late", "later", 
                "laugh", "law", "lawyer", "lay", "lead", "leader", "learn", "least", "leave", "left", "leg", "legal", "less", 
                "let", "letter", "level", "lie", "life", "light", "like", "likely", "line", "list", "listen", "little", "live", 
                "local", "long", "look", "lose", "loss", "lot", "love", "low", "machine", "magazine", "main", "maintain", "major", 
                "majority", "make", "man", "manage", "management", "manager", "many", "market", "marriage", "material", "matter", 
                "may", "maybe", "me", "mean", "measure", "media", "medical", "meet", "meeting", "member", "memory", "mention", 
                "message", "method", "middle", "might", "military", "million", "mind", "minute", "miss", "mission", "model", 
                "modern", "moment", "money", "month", "more", "morning", "most", "mother", "mouth", "move", "movement", "movie", 
                "Mr", "Mrs", "much", "music", "must", "my", "myself", "name", "nation", "national", "natural", "nature", "near", 
                "nearly", "necessary", "need", "network", "never", "new", "news", "newspaper", "next", "nice", "night", "no", 
                "none", "nor", "north", "not", "note", "nothing", "notice", "now", "n't", "number", "occur", "of", "off", "offer", 
                "office", "officer", "official", "often", "oh", "oil", "ok", "old", "on", "once", "one", "only", "onto", "open", 
                "operation", "opportunity", "option", "or", "order", "organization", "other", "others", "our", "out", "outside", 
                "over", "own", "owner", "page", "pain", "painting", "paper", "parent", "part", "participant", "particular", 
                "particularly", "partner", "party", "pass", "past", "patient", "pattern", "pay", "peace", "people", "per", 
                "perform", "performance", "perhaps", "period", "person", "personal", "phone", "physical", "pick", "picture", 
                "piece", "place", "plan", "plant", "play", "player", "PM", "point", "police", "policy", "political", "politics", 
                "poor", "popular", "population", "position", "positive", "possible", "power", "practice", "prepare", "present", 
                "president", "pressure", "pretty", "prevent", "price", "private", "probably", "problem", "process", "produce", 
                "product", "production", "professional", "professor", "program", "project", "property", "protect", "prove", 
                "provide", "public", "pull", "purpose", "push", "put", "quality", "question", "quickly", "quite", "race", 
                "radio", "raise", "range", "rate", "rather", "reach", "read", "ready", "real", "reality", "realize", "really", 
                "reason", "receive", "recent", "recently", "recognize", "record", "red", "reduce", "reflect", "region", "relate", 
                "relationship", "religious", "remain", "remember", "remove", "report", "represent", "Republican", "require", 
                "research", "resource", "respond", "response", "responsibility", "rest", "result", "return", "reveal", "rich", 
                "right", "rise", "risk", "road", "rock", "role", "room", "rule", "run", "safe", "same", "save", "say", "scene", 
                "school", "science", "scientist", "score", "sea", "season", "seat", "second", "section", "security", "see", 
                "seek", "seem", "sell", "send", "senior", "sense", "series", "serious", "serve", "service", "set", "seven", 
                "several", "sex", "sexual", "shake", "share", "she", "shoot", "short", "shot", "should", "shoulder", "show", 
                "side", "sign", "significant", "similar", "simple", "simply", "since", "sing", "single", "sister", "sit", "site", 
                "situation", "six", "size", "skill", "skin", "small", "smile", "so", "social", "society", "soldier", "some", 
                "somebody", "someone", "something", "sometimes", "son", "song", "soon", "sort", "sound", "source", "south", 
                "southern", "space", "speak", "special", "specific", "speech", "spend", "sport", "spring", "staff", "stage", 
                "stand", "standard", "star", "start", "state", "statement", "station", "stay", "step", "still", "stock", "stop", 
                "store", "story", "strategy", "street", "strong", "structure", "student", "study", "stuff", "style", "subject", 
                "success", "successful", "such", "suddenly", "suffer", "suggest", "summer", "support", "sure", "surface", 
                "system", "table", "take", "talk", "task", "tax", "teach", "teacher", "team", "technology", "television", 
                "tell", "ten", "tend", "term", "test", "than", "thank", "that", "the", "their", "them", "themselves", "then", 
                "theory", "there", "these", "they", "thing", "think", "third", "this", "those", "though", "thought", "thousand", 
                "threat", "three", "through", "throughout", "throw", "thus", "time", "to", "today", "together", "tonight", "too", 
                "top", "total", "tough", "toward", "town", "trade", "traditional", "training", "travel", "treat", "treatment", 
                "tree", "trial", "trip", "trouble", "true", "truth", "try", "turn", "TV", "two", "type", "under", "understand", 
                "unit", "until", "up", "upon", "us", "use", "usually", "value", "various", "very", "victim", "view", "violence", 
                "visit", "voice", "vote", "wait", "walk", "wall", "want", "war", "watch", "water", "way", "we", "weapon", "wear", 
                "week", "weight", "welcome", "well", "west", "western", "what", "whatever", "when", "where", "whether", "which", 
                "while", "white", "who", "whole", "whom", "whose", "why", "wide", "wife", "will", "win", "wind", "window", "wish", 
                "with", "within", "without", "woman", "wonder", "word", "work", "worker", "world", "worry", "would", "write", 
                "writer", "wrong", "yard", "yeah", "year", "yes", "yet", "you", "young", "your", "yourself","spicy444", "vikram"
            ];

            // --- Theme Toggle ---
            const themeToggleBtn = document.getElementById('theme-toggle-btn');
            const body = document.body;
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme) {
                body.classList.add(savedTheme);
                themeToggleBtn.innerHTML = savedTheme === 'dark-mode' ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
            } else {
                body.classList.add('dark-mode');
                themeToggleBtn.innerHTML = '<i class="fas fa-sun"></i>';
            }

            themeToggleBtn.addEventListener('click', () => {
                body.classList.toggle('dark-mode');
                body.classList.toggle('light-mode');
                let theme = body.classList.contains('dark-mode') ? 'dark-mode' : 'light-mode';
                themeToggleBtn.innerHTML = theme === 'dark-mode' ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
                localStorage.setItem('theme', theme);
            });

            // --- Editor Functionality ---
            editor.innerHTML = localStorage.getItem('editorContent') || '';
            editor.addEventListener('input', function() {
                localStorage.setItem('editorContent', editor.innerHTML);
                updateAllStats();
                handleAutocomplete();
            });
             

            // --- Toolbar ---
            const boldBtn = document.getElementById('bold-btn');
            const italicBtn = document.getElementById('italic-btn');
            const underlineBtn = document.getElementById('underline-btn');
            const unorderedListBtn = document.getElementById('unorderedListBtn');
            const orderedListBtn = document.getElementById('orderedListBtn');
            const undoBtn = document.getElementById('undo-btn');
            const redoBtn = document.getElementById('redo-btn');
            const fontSelect = document.getElementById('font-select');

            boldBtn.addEventListener('click', () => {
                document.execCommand('bold', false, null);
                editor.focus();
                updateButtonStates();
            });
            
            italicBtn.addEventListener('click', () => {
                document.execCommand('italic', false, null);
                editor.focus();
                updateButtonStates();
            });
            
            underlineBtn.addEventListener('click', () => {
                document.execCommand('underline', false, null);
                editor.focus();
                updateButtonStates();
            });
            
            unorderedListBtn.addEventListener('click', () => {
                document.execCommand('insertUnorderedList', false, null);
                editor.focus();
            });
            
            orderedListBtn.addEventListener('click', () => {
                document.execCommand('insertOrderedList', false, null);
                editor.focus();
            });
            
            undoBtn.addEventListener('click', () => {
                document.execCommand('undo', false, null);
                editor.focus();
            });
            
            redoBtn.addEventListener('click', () => {
                document.execCommand('redo', false, null);
                editor.focus();
            });

            fontSelect.addEventListener('change', (e) => {
                document.execCommand('fontName', false, e.target.value);
                editor.focus();
            });

             // Update button states based on current selection
            function updateButtonStates() {
                boldBtn.classList.toggle('active', document.queryCommandState('bold'));
                italicBtn.classList.toggle('active', document.queryCommandState('italic'));
                underlineBtn.classList.toggle('active', document.queryCommandState('underline'));
            }
            
            // Track selection changes to update button states
            editor.addEventListener('keyup', updateButtonStates);
            editor.addEventListener('mouseup', updateButtonStates);
            document.addEventListener('selectionchange', () => {
                 if (document.activeElement === editor) {
                    updateButtonStates();
                }
            });
            
            // Keyboard shortcuts
            editor.addEventListener('keydown', (e) => {
                if (e.ctrlKey || e.metaKey) {
                    switch (e.key.toLowerCase()) {
                        case 'b':
                            e.preventDefault();
                            document.execCommand('bold', false, null);
                            updateButtonStates();
                            break;
                        case 'i':
                            e.preventDefault();
                            document.execCommand('italic', false, null);
                            updateButtonStates();
                            break;
                        case 'u':
                            e.preventDefault();
                            document.execCommand('underline', false, null);
                            updateButtonStates();
                            break;
                    }
                }
            });
            
            // --- Autocomplete Logic ---
            let activeSuggestion = -1;

            function handleAutocomplete() {
                const selection = window.getSelection();
                if (!selection.rangeCount) return;

                const range = selection.getRangeAt(0);
                const textBeforeCursor = range.startContainer.textContent.substring(0, range.startOffset);
                const currentWordMatch = textBeforeCursor.match(/\S+$/);
                
                if (!currentWordMatch) {
                    hideAutocomplete();
                    return;
                }

                const currentWord = currentWordMatch[0];
                if (currentWord.length < 2) {
                    hideAutocomplete();
                    return;
                }

                const suggestions = dictionary.filter(word => word.startsWith(currentWord.toLowerCase()) && word !== currentWord.toLowerCase());
                
                if (suggestions.length > 0) {
                    showAutocomplete(suggestions, range);
                } else {
                    hideAutocomplete();
                }
            }

            function showAutocomplete(suggestions, range) {
                autocompleteBox.innerHTML = '';
                suggestions.slice(0, 5).forEach((suggestion) => {
                    const item = document.createElement('div');
                    item.className = 'autocomplete-item';
                    item.textContent = suggestion;
                    item.addEventListener('click', () => {
                        acceptSuggestion(suggestion);
                    });
                    autocompleteBox.appendChild(item);
                });

                const editorRect = editorContainer.getBoundingClientRect();
                const rangeRect = range.getBoundingClientRect();

                autocompleteBox.style.left = `${rangeRect.left - editorRect.left}px`;
                autocompleteBox.style.top = `${rangeRect.bottom - editorRect.top}px`;
                autocompleteBox.style.display = 'block';
                activeSuggestion = -1;
            }

            function hideAutocomplete() {
                autocompleteBox.style.display = 'none';
                activeSuggestion = -1;
            }

            function acceptSuggestion(suggestion) {
                const selection = window.getSelection();
                if (!selection.rangeCount) return;

                const range = selection.getRangeAt(0);
                const textNode = range.startContainer;
                const textBeforeCursor = textNode.textContent.substring(0, range.startOffset);
                const currentWordMatch = textBeforeCursor.match(/\S+$/);

                if (currentWordMatch) {
                    const currentWord = currentWordMatch[0];
                    range.setStart(textNode, range.startOffset - currentWord.length);
                    range.deleteContents();
                    const newNode = document.createTextNode(suggestion + ' ');
                    range.insertNode(newNode);
                    
                    range.setStart(newNode, newNode.length);
                    range.collapse(true);
                    selection.removeAllRanges();
                    selection.addRange(range);
                }
                hideAutocomplete();
                editor.focus();
            }

            editor.addEventListener('keydown', (e) => {
                if (autocompleteBox.style.display === 'block') {
                    const items = autocompleteBox.querySelectorAll('.autocomplete-item');
                    if (e.key === 'ArrowDown') {
                        e.preventDefault();
                        activeSuggestion = (activeSuggestion + 1) % items.length;
                        updateActiveSuggestion(items);
                    } else if (e.key === 'ArrowUp') {
                        e.preventDefault();
                        activeSuggestion = (activeSuggestion - 1 + items.length) % items.length;
                        updateActiveSuggestion(items);
                    } else if ((e.key === 'Enter' || e.key === 'Tab') && activeSuggestion > -1) {
                        e.preventDefault();
                        acceptSuggestion(items[activeSuggestion].textContent);
                    } else if (e.key === 'Escape') {
                        hideAutocomplete();
                    }
                }
            });
            
            function updateActiveSuggestion(items) {
                items.forEach((item, index) => {
                    item.classList.toggle('active', index === activeSuggestion);
                });
            }

            document.addEventListener('click', (e) => {
                if (!editor.contains(e.target) && !autocompleteBox.contains(e.target)) {
                    hideAutocomplete();
                }
            });


            // --- Stats Calculation ---
            function updateAllStats() {
                const text = editor.innerText;
                const words = text.match(/\b\w+\b/g) || [];
                const sentences = text.match(/[^.!?]+[.!?]+/g) || [];
                const paragraphs = text.split(/\n\s*\n/).filter(p => p.trim() !== '');
                const chars = text.length;
                const syllables = countSyllables(text);

                document.getElementById('word-count').textContent = words.length;
                document.getElementById('char-count').textContent = chars;
                document.getElementById('sentence-count').textContent = sentences.length;
                document.getElementById('paragraph-count').textContent = paragraphs.length;
                document.getElementById('reading-time').textContent = `${Math.ceil(words.length / 200)} min`;
                
                updateReadability(words.length, sentences.length, syllables);
                updateGrammarStats(text, words);
                updateGoalProgress(words.length);
            }

            function countSyllables(text) {
                if (text.length === 0) return 0;
                text = text.toLowerCase().replace(/[^a-z]/g, ' ');
                let syllableCount = 0;
                const words = text.split(/\s+/).filter(Boolean);
                words.forEach(word => {
                    if (word.length <= 3) { syllableCount += 1; return; }
                    word = word.replace(/(?:[^laeiouy]es|ed|[^laeiouy]e)$/, '');
                    word = word.replace(/^y/, '');
                    const vowels = word.match(/[aeiouy]{1,2}/g);
                    syllableCount += vowels ? vowels.length : 0;
                });
                return syllableCount;
            }

            function updateReadability(wordCount, sentenceCount, syllableCount) {
                const scoreEl = document.getElementById('readability-score');
                const gradeEl = document.getElementById('readability-grade');
                if (wordCount === 0 || sentenceCount === 0) {
                    scoreEl.textContent = 'N/A';
                    gradeEl.textContent = 'Not enough text';
                    return;
                }
                const score = 206.835 - 1.015 * (wordCount / sentenceCount) - 84.6 * (syllableCount / wordCount);
                scoreEl.textContent = score.toFixed(1);
                scoreEl.className = '';
                if (score >= 60) { scoreEl.classList.add('easy'); gradeEl.textContent = 'Easy to read'; } 
                else if (score >= 30) { scoreEl.classList.add('moderate'); gradeEl.textContent = 'Slightly difficult'; } 
                else { scoreEl.classList.add('difficult'); gradeEl.textContent = 'Very difficult'; }
            }
            
            function updateGrammarStats(text, words) {
                const passiveRegex = /\b(is|are|was|were|be|being|been)\s+\w+ed\b/gi;
                document.getElementById('passive-count').textContent = (text.match(passiveRegex) || []).length;
                const fillerWords = ['very', 'really', 'just', 'actually', 'basically', 'literally'];
                const fillerRegex = new RegExp(`\\b(${fillerWords.join('|')})\\b`, 'gi');
                document.getElementById('filler-count').textContent = (text.match(fillerRegex) || []).length;
                let repeatedCount = 0;
                for (let i = 0; i < words.length - 1; i++) {
                    if (words[i].toLowerCase() === words[i+1].toLowerCase()) repeatedCount++;
                }
                document.getElementById('repeated-count').textContent = repeatedCount;
            }

            // --- Productivity Tools ---
            document.getElementById('focus-mode-btn').addEventListener('click', () => {
                body.classList.toggle('focus-mode');
                const icon = document.getElementById('focus-mode-btn').querySelector('i');
                icon.classList.toggle('fa-expand');
                icon.classList.toggle('fa-compress');
            });

            const timerDisplay = document.getElementById('timer-display');
            const startTimerBtn = document.getElementById('start-timer-btn');
            const resetTimerBtn = document.getElementById('reset-timer-btn');
            let timerInterval, timeLeft = 25 * 60, isWorkSession = true;
            
            function updateTimerDisplay() {
                timerDisplay.textContent = `${Math.floor(timeLeft / 60).toString().padStart(2, '0')}:${(timeLeft % 60).toString().padStart(2, '0')}`;
            }

            startTimerBtn.addEventListener('click', () => {
                if (timerInterval) {
                    clearInterval(timerInterval);
                    timerInterval = null;
                    startTimerBtn.textContent = isWorkSession ? "Resume Work" : "Resume Break";
                } else {
                    startTimerBtn.textContent = "Pause";
                    timerInterval = setInterval(() => {
                        timeLeft--;
                        updateTimerDisplay();
                        if (timeLeft <= 0) {
                            clearInterval(timerInterval);
                            timerInterval = null;
                            alert(isWorkSession ? "Time for a break!" : "Time to get back to work!");
                            isWorkSession = !isWorkSession;
                            timeLeft = isWorkSession ? 25 * 60 : 5 * 60;
                            updateTimerDisplay();
                            startTimerBtn.textContent = isWorkSession ? "Start Work" : "Start Break";
                        }
                    }, 1000);
                }
            });
            
            resetTimerBtn.addEventListener('click', () => {
                clearInterval(timerInterval);
                timerInterval = null;
                isWorkSession = true;
                timeLeft = 25 * 60;
                updateTimerDisplay();
                startTimerBtn.textContent = "Start Work";
            });

            const goalInput = document.getElementById('goal-input');
            const goalProgress = document.getElementById('goal-progress');
            goalInput.value = localStorage.getItem('writingGoal') || '';
            
            goalInput.addEventListener('input', () => {
                localStorage.setItem('writingGoal', goalInput.value);
                updateGoalProgress(document.getElementById('word-count').textContent);
            });

            function updateGoalProgress(wordCount) {
                const goal = parseInt(goalInput.value, 10);
                if (!goal || goal <= 0) {
                    goalProgress.style.width = '0%';
                    goalProgress.textContent = '0%';
                    return;
                }
                const percentage = Math.min(100, (wordCount / goal) * 100);
                goalProgress.style.width = `${percentage}%`;
                goalProgress.textContent = `${Math.round(percentage)}%`;
            }

            // --- Export ---
            const { jsPDF } = window.jspdf;
            document.getElementById('export-txt-btn').addEventListener('click', () => {
                const blob = new Blob([editor.innerText], { type: 'text/plain' });
                const a = document.createElement('a');
                a.href = URL.createObjectURL(blob);
                a.download = 'spicy444_note_editor.txt';
                a.click();
                URL.revokeObjectURL(a.href);
            });
            
            document.getElementById('export-md-btn').addEventListener('click', () => {
                const blob = new Blob([editor.innerText], { type: 'text/markdown' });
                const a = document.createElement('a');
                a.href = URL.createObjectURL(blob);
                a.download = 'spicy444_note_editor.md';
                a.click();
                URL.revokeObjectURL(a.href);
            });
            
            document.getElementById('export-pdf-btn').addEventListener('click', () => {
                const doc = new jsPDF();
                doc.text(editor.innerText, 10, 10);
                doc.save('spicy444_note_editor.pdf');
            });
            
            // --- Reset App ---
            document.getElementById('reset-app').addEventListener('click', (e) => {
                e.preventDefault();
                if (confirm('Are you sure you want to reset the application? All your data will be lost.')) {
                    localStorage.clear();
                    location.reload();
                }
            });

            // Initial calculation
            updateAllStats();
            updateButtonStates();
        });
    </script>
</body>
</html>
